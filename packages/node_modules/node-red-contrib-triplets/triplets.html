<script type="text/javascript">
    // Load custom triplets editor resources
    $.getScript('/custom/triplets/js/triplets-editor.js');
    $('<link>', {
        rel: 'stylesheet',
        type: 'text/css',
        href: '/custom/triplets/css/triplets-editor.css'
    }).appendTo('head');
    
    RED.events.on("editor:open", function(node) {
        if (node.type === "triplets") {
            if (!$('#triplet-dialog-styles').length) {
                $('head').append(
                    '<style id="triplet-dialog-styles">' +
                    '.red-ui-editor .red-ui-tray-content { width: 950px !important; }' +
                    '.red-ui-editor .red-ui-tray-content .red-ui-tray-content-content { width: 950px !important; }' +
                    '.red-ui-editor .form-row input, .red-ui-editor .form-row select { width: 70%; }' +
                    '.form-row input[type="hidden"] + div.red-ui-typedInput-container { width: 70% !important; }' +
                    '.red-ui-editor-stack { right: calc(100% - 950px) !important; }' +
                    '.red-ui-editor .red-ui-tray-footer { width: 950px; }' +
                    '.template-row .select2-container { width: 100% !important; }' +
                    '.template-row .select2-container .select2-selection { height: 36px !important; }' +
                    '.template-row .select2-container .select2-selection .select2-selection__rendered { line-height: 36px !important; }' +
                    '.template-row .select2-container .select2-selection .select2-selection__arrow { height: 36px !important; }' +
                    '</style>'
                );
                
                // Add the triplets-editor CSS class to the editor
                $('.red-ui-tray-content').addClass('triplets-editor');
                $('.red-ui-tray-footer').addClass('triplets-editor-footer');
            }
        }
    });

    RED.events.on("editor:close", function(node) {
        if (node.type === "triplets") {
            $('#triplet-dialog-styles').remove();
        }
    });

    RED.nodes.registerType('triplets',{
        category: 'custom',
        color: '#a6bbcf',
        defaults:{
            name:{value:""},
            payload:{value:""},
            broker: {type:"mqtt-broker", required:true},
            topic:{value:"", required:true},
            qos: {value:"0"},
            prompt: {value:""},
            objective: {value:""},
            
            templates: {value:[
                {subject:"", predicate:"", object:"", enableStorage: false}, 
                {subject:"", predicate:"", object:"", enableStorage: false}
            ]},
            
            apiEndpoint: {value:""},
            
            functions: {value:[
                {name:"Function 1", code:""}
            ]},
            
            debugEnabled: {value: false}
        },
        inputs:1,
        outputs:1,
        icon:'bridge.png',
        label:function(){
            return this.name||'triplets';
        },
        labelStyle: function(){
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var node = this;
            
            setupDialogEditor("prompt", "Prompt", "Enter the prompt text that will guide the processing");
            
            setupDialogEditor("objective", "Objective", "Define the objective of this processing step");
            
            function setupDialogEditor(fieldName, title, placeholder) {
                var fieldValue = node[fieldName] || "";
                var fieldPreview = fieldValue.length > 0 ? fieldValue : "Click to edit...";
                
                // Set preview text (truncated)
                $("#node-input-" + fieldName + "-preview").text(fieldPreview);
                
                // Set hidden input value
                $("#node-input-" + fieldName).val(fieldValue);
                
                // Handle click on container to open editor
                $("#node-input-" + fieldName + "-container").click(function() {
                    var editorDialog = $('<div id="node-input-' + fieldName + '-dialog" class="editor-dialog"></div>')
                        .appendTo("body")
                        .dialog({
                            title: title,
                            modal: true,
                            width: 800,
                            height: window.innerHeight * 0.8,
                            resizable: true,
                            open: function() {
                                var textarea = $('<textarea style="width: 100%; height: calc(100% - 40px); margin-bottom: 10px; resize: none; overflow-y: auto; overflow-x: hidden; white-space: pre-wrap; word-wrap: break-word;"></textarea>')
                                    .val($("#node-input-" + fieldName).val() || "")
                                    .attr("placeholder", placeholder)
                                    .appendTo(this);
                                    
                                var buttonRow = $('<div style="text-align: right;"></div>').appendTo(this);
                                
                                $('<button>Cancel</button>')
                                    .button()
                                    .appendTo(buttonRow)
                                    .click(function() {
                                        $(editorDialog).dialog('close');
                                    });
                                    
                                $('<button>Save</button>')
                                    .button()
                                    .css("margin-left", "10px")
                                    .appendTo(buttonRow)
                                    .click(function() {
                                        var value = textarea.val();
                                        $("#node-input-" + fieldName).val(value);
                                        
                                        var preview = value.length > 0 ? value : "Click to edit...";
                                        if (preview.length > 50) {
                                            preview = preview.substring(0, 47) + "...";
                                        }
                                        $("#node-input-" + fieldName + "-preview").text(preview);
                                        
                                        $(editorDialog).dialog('close');
                                    });
                            },
                            close: function() {
                                $(this).dialog('destroy');
                                $(this).remove();
                            }
                        });
                });
            }
            
            // Define the triplet data as a dictionary
            var tripletData = {
                entities: [
                    "Appointment",
                    "Diagnosis",
                    "Doctor", 
                    "Hospital",
                    "LabTest",
                    "Medication",
                    "Patient", 
                    "Result",
                    "Symptom", 
                    "Treatment"
                ],
                relations: [
                    "diagnosed_with", 
                    "has_appointment_with", 
                    "has_symptom", 
                    "located_at", 
                    "performed_by",
                    "prescribed", 
                    "resulted_in", 
                    "scheduled_for", 
                    "treated_with", 
                    "underwent"
                ]
            };
            
            var toolsData = {
                tools: [
                    {
                        name: "Calculate Fibonacci",
                        code: `"""
Calculate Fibonacci sequence up to n numbers

Parameters
----------
n : int
    Number of Fibonacci sequence elements to generate

Returns
-------
list
    List containing the Fibonacci sequence
"""
def fibonacci(n):
    """Generate Fibonacci sequence up to n elements"""
    result = []
    a, b = 0, 1
    for _ in range(n):
        result.append(a)
        a, b = b, a + b
    return result

# Example usage
numbers = fibonacci(10)
print(numbers)  # [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]`
                    },
                    {
                        name: "Prime Number Checker",
                        code: `"""
Check if a number is prime

Parameters
----------
num : int
    The number to check

Returns
-------
bool
    True if the number is prime, False otherwise
"""
def is_prime(num):
    """Check if a number is prime"""
    if num <= 1:
        return False
    if num <= 3:
        return True
    if num % 2 == 0 or num % 3 == 0:
        return False
    
    i = 5
    while i * i <= num:
        if num % i == 0 or num % (i + 2) == 0:
            return False
        i += 6
    
    return True

# Example usage
print(is_prime(17))  # True
print(is_prime(20))  # False`
                    },
                    {
                        name: "Text Analyzer",
                        code: `"""
Analyze text and return various statistics

Parameters
----------
text : str
    The input text to analyze

Returns
-------
dict
    Dictionary containing text statistics
"""
def analyze_text(text):
    """Analyze text for various metrics"""
    if not text:
        return {
            "word_count": 0,
            "char_count": 0,
            "letter_frequency": {}
        }
    
    # Basic counts
    words = text.split()
    word_count = len(words)
    char_count = len(text)
    
    # Letter frequency
    letter_frequency = {}
    for char in text.lower():
        if char.isalpha():
            letter_frequency[char] = letter_frequency.get(char, 0) + 1
    
    # Prepare results
    return {
        "word_count": word_count,
        "char_count": char_count,
        "letter_frequency": letter_frequency
    }

# Example usage
sample_text = "Hello world, this is a sample text."
result = analyze_text(sample_text)
print(f"Word count: {result['word_count']}")
print(f"Character count: {result['char_count']}")
print(f"Most common letter: {max(result['letter_frequency'].items(), key=lambda x: x[1])}")`
                    }
                ]
            };
            
            // Extract the entities and relations from the dictionary
            window.tripletEntities = tripletData.entities;
            window.tripletRelations = tripletData.relations;
            
            // Extract tools from dictionary
            window.toolsList = toolsData.tools;
            
            // Initialize the template container
            initializeTemplates();
                
            function initializeTemplates() {
                var templateContainer = $("#node-input-template-container");
                templateContainer.empty();
                
                // Load templates
                if (node.templates && node.templates.length) {
                    for (var i=0; i<node.templates.length; i++) {
                        addTemplateRow(node.templates[i]);
                    }
                } else {
                    // Add default rows if none exist
                    addTemplateRow({subject:"Patient", predicate:"has_appointment_with", object:"msg.payload.name", enableStorage: false});
                    addTemplateRow({subject:"Patient", predicate:"has_symptom", object:"msg.payload.symptom", enableStorage: false});
                }
            }
            
            // Setup add template button
            $("#node-input-add-template").click(function() {
                addTemplateRow({subject:"", predicate:"", object:"", enableStorage: false});
            });
            
            function addTemplateRow(template) {
                // Create a clean, compact row container
                var container = $('<div/>',{class:"form-row template-row"}).css({
                    "margin-bottom": "8px",
                    "position": "relative",
                    "padding": "6px 8px",
                    "background-color": "#f9f9f9",
                    "border-radius": "4px",
                    "display": "flex",
                    "align-items": "center",
                    "flex-wrap": "nowrap"
                });
                
            
                var subjectField = $('<select/>',{class:"node-input-template-subject"})
                    .css({
                        "flex": "1",
                        "margin-right": "8px",
                        "height": "36px",
                        "padding": "6px",
                        "font-size": "14px",
                        "min-width": "0"
                    });
                
                
                subjectField.append($('<option value="">-- Subject --</option>'));
                if (window.tripletEntities && window.tripletEntities.length) {
                    window.tripletEntities.forEach(function(entity) {
                        var option = $('<option/>').text(entity).val(entity);
                        if (template.subject === entity) {
                            option.attr('selected', 'selected');
                        }
                        subjectField.append(option);
                    });
                }
                
                
                var predicateField = $('<select/>',{class:"node-input-template-predicate"})
                    .css({
                        "flex": "1",
                        "margin-right": "8px",
                        "height": "36px",
                        "padding": "6px",
                        "font-size": "14px",
                        "min-width": "0"
                    });
                
                
                predicateField.append($('<option value="">-- Predicate --</option>'));
                if (window.tripletRelations && window.tripletRelations.length) {
                    window.tripletRelations.forEach(function(relation) {
                        var option = $('<option/>').text(relation).val(relation);
                        if (template.predicate === relation) {
                            option.attr('selected', 'selected');
                        }
                        predicateField.append(option);
                    });
                }
                
                
                var objectField = $('<input/>',{
                    class:"node-input-template-object",
                    type:"text"
                })
                .css({
                    "flex": "1",
                    "margin-right": "8px",
                    "height": "36px",
                    "padding": "6px 10px",
                    "font-size": "14px",
                    "min-width": "0"
                })
                .attr("placeholder", "Object (e.g., msg.payload.value)")
                .val(template.object || "");
                
                
                var storageContainer = $('<div/>').css({
                    "display": "flex",
                    "align-items": "center",
                    "margin-right": "8px",
                    "white-space": "nowrap"
                });
                
                var storageCheckbox = $('<input/>',{
                    class:"node-input-template-storage",
                    type:"checkbox",
                    id: "storage-" + Date.now()
                })
                .css({
                    "margin": "0 5px 0 0"
                })
                .prop("checked", template.enableStorage === true);
                
                var storageLabel = $('<label/>')
                    .attr("for", storageCheckbox.attr("id"))
                    .text("Store")
                    .css({
                        "font-weight": "normal",
                        "font-size": "14px",
                        "margin": "0",
                        "cursor": "pointer"
                    });
                
                storageContainer.append(storageCheckbox).append(storageLabel);
                
                // Delete button - compact design
                var deleteButton = $('<a/>',{href:"#", class:"editor-button editor-button-small"})
                    .append($('<i/>',{class:"fa fa-trash"}))
                    .css({
                        "padding": "6px 8px",
                        "margin-left": "auto"
                    })
                    .click(function(e) {
                        e.preventDefault();
                        container.remove();
                    });
                
                // Add all elements to the container
                container.append(subjectField)
                         .append(predicateField)
                         .append(objectField)
                         .append(storageContainer)
                         .append(deleteButton);
                
                // Add the container to the template container
                $("#node-input-template-container").append(container);
                
                // Initialize select2 for searchable dropdowns if available
                if ($.fn.select2) {
                    var select2Config = {
                        placeholder: "Select...",
                        allowClear: true,
                        tags: true,
                        width: '100%',
                        dropdownAutoWidth: false
                    };
                    
                    subjectField.select2(select2Config);
                    predicateField.select2(select2Config);
                }
            }
            
            // Initialize function editors
            var functionContainer = $("#node-input-function-container");
            functionContainer.empty();
            var functionEditors = {};
            var functionCounter = 0;
            
            // Load tools
            if (node.functions && node.functions.length) {
                for (var i=0; i<node.functions.length; i++) {
                    addFunctionRow(node.functions[i], functionCounter++);
                }
            } else if (window.toolsList && window.toolsList.length) {
                // Use the predefined tools if no custom functions are defined yet
                for (var i=0; i<window.toolsList.length; i++) {
                    addFunctionRow(window.toolsList[i], functionCounter++);
                }
            } else {
                // Add a default function if none exists
                addFunctionRow({
                    name: "Tool 1",
                    code: ""
                }, functionCounter++);
            }
            
            // Setup add function button
            $("#node-input-add-function").click(function() {
                addFunctionRow({
                    name: "Tool " + (functionCounter + 1),
                    code: ""
                }, functionCounter++);
            });
            
            function addFunctionRow(functionDef, id) {
                var container = $('<div/>',{class:"form-row function-row", id:"function-row-" + id});
                
                // Function name
                var headerRow = $('<div/>',{class:"form-row function-header-row"});
                var functionLabel = $('<span/>').text("Tool Name: ").css({"margin-right":"10px"});
                var nameField = $('<input/>',{
                    class:"node-input-function-name",
                    type:"text",
                    id: "node-input-function-name-" + id
                })
                .css({"width":"50%", "margin-right":"10px", "height": "34px", "padding": "4px 8px"})
                .attr("placeholder", "Tool Name")
                .val(functionDef.name || "");
                
                // Delete button
                var deleteButton = $('<a/>',{href:"#", class:"editor-button editor-button-small"})
                    .append($('<i/>',{class:"fa fa-trash fa-lg"}))
                    .css({
                        "padding": "6px 10px"
                    })
                    .click(function(e) {
                        e.preventDefault();
                        
                        // Remove the editor from the registry
                        delete functionEditors["function-editor-" + id];
                        
                        // Remove the container and its separator
                        container.next("hr").remove();
                        container.remove();
                    });
                
                headerRow.append(functionLabel)
                         .append(nameField)
                         .append(deleteButton);
                
                // Code editor
                var editorRow = $('<div/>',{class:"form-row", style:"position:relative"});
                var editorContainer = $('<div/>',{
                    style:"width: 100%; height: 300px; min-height:200px;",
                    class:"node-text-editor",
                    id: "node-input-function-editor-" + id
                });
                
                editorRow.append(editorContainer);
                
                container.append(headerRow)
                         .append(editorRow);
                
                // Add a separator before each function (except the first one)
                if (functionContainer.children().length > 0) {
                    functionContainer.append($('<hr/>',{style:"margin-top:20px; margin-bottom:20px;"}));
                }
                         
                functionContainer.append(container);
                
                // Setup ACE editor
                var editor = RED.editor.createEditor({
                    id: "node-input-function-editor-" + id,
                    mode: "ace/mode/python",
                    value: functionDef.code || ""
                });
                
                // Store the editor reference
                functionEditors["function-editor-" + id] = editor;
            }
            
            // Store editor references
            this.functionEditors = functionEditors;
        },
        oneditsave: function() {
            var node = this;
            
            // Save templates
            var templates = [];
            
            $(".template-row").each(function() {
                var row = $(this);
                var subject = row.find(".node-input-template-subject").val();
                var predicate = row.find(".node-input-template-predicate").val();
                var object = row.find(".node-input-template-object").val();
                var enableStorage = row.find(".node-input-template-storage").is(":checked");
                
                if (subject && predicate && object) {
                    templates.push({
                        subject: subject,
                        predicate: predicate,
                        object: object,
                        enableStorage: enableStorage
                    });
                }
            });
            
            node.templates = templates;
            
            // Save functions
            var functions = [];
            
            $(".function-row").each(function() {
                var id = $(this).attr("id").replace("function-row-", "");
                var name = $(this).find(".node-input-function-name").val() || "Function";
                var editor = node.functionEditors["function-editor-" + id];
                var code = editor ? editor.getValue() : "";
                
                functions.push({
                    name: name,
                    code: code
                });
            });
            
            node.functions = functions;
            
            // Remove custom styles when closing the dialog
            $('#triplet-dialog-styles').remove();
        },
        oneditcancel: function() {
            // Cleanup ACE editors when the dialog is cancelled
            if (this.functionEditors) {
                for (var id in this.functionEditors) {
                    if (this.functionEditors.hasOwnProperty(id)) {
                        this.functionEditors[id].destroy();
                    }
                }
            }
            
            // Remove custom styles when closing the dialog
            $('#triplet-dialog-styles').remove();
        },
        oneditdelete: function() {
            // Cleanup ACE editors when the node is deleted
            if (this.functionEditors) {
                for (var id in this.functionEditors) {
                    if (this.functionEditors.hasOwnProperty(id)) {
                        this.functionEditors[id].destroy();
                    }
                }
            }
            
            // Remove custom styles when closing the dialog
            $('#triplet-dialog-styles').remove();
        }
    });

</script>

<script type="text/html" data-template-name = "triplets">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    
    <!-- Processing Options Section - Prompt and Objective -->
    <div class="form-row">
        <label for="node-input-prompt-container"><i class="fa fa-comment"></i> Prompt</label>
        <div style="display: inline-block; position: relative; width: 70%; height: 34px;">
            <div style="position: absolute; left: 0; right: 0; top: 0; bottom: 0; display: flex; align-items: center; overflow: hidden; border: 1px solid #ccc; border-radius: 4px; padding: 0 8px; cursor: pointer;" id="node-input-prompt-container">
                <div style="text-overflow: ellipsis; overflow: hidden; white-space: nowrap;" id="node-input-prompt-preview"></div>
                <input type="hidden" id="node-input-prompt">
            </div>
        </div>
    </div>
    
    <div class="form-row">
        <label for="node-input-objective-container"><i class="fa fa-bullseye"></i> Objective</label>
        <div style="display: inline-block; position: relative; width: 70%; height: 34px;">
            <div style="position: absolute; left: 0; right: 0; top: 0; bottom: 0; display: flex; align-items: center; overflow: hidden; border: 1px solid #ccc; border-radius: 4px; padding: 0 8px; cursor: pointer;" id="node-input-objective-container">
                <div style="text-overflow: ellipsis; overflow: hidden; white-space: nowrap;" id="node-input-objective-preview"></div>
                <input type="hidden" id="node-input-objective">
            </div>
        </div>
    </div>
    
    <!-- MQTT Section - Always visible, no checkbox -->
    <div class="form-row">
        <label for="node-input-broker"><i class="fa fa-globe"></i> MQTT Broker</label>
        <input type="text" id="node-input-broker">
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> MQTT Topic</label>
        <input type="text" id="node-input-topic" placeholder="topic">
    </div>
    <div class="form-row">
        <label for="node-input-qos"><i class="fa fa-empire"></i> QoS</label>
        <select id="node-input-qos" style="width:125px !important">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
        </select>
    </div>
    
    <!-- Knowledge Graph Triplet Templates Section -->
    <!-- API Endpoint (Common for all templates) -->
    <div class="form-row">
        <label for="node-input-apiEndpoint"><i class="fa fa-link"></i> API Endpoint for triplets</label>
        <input type="text" id="node-input-apiEndpoint" placeholder="http://your-api-endpoint">
    </div>
    
    <!-- Triplet templates section with header and add button -->
    <div class="form-row">
        <label><i class="fa fa-list"></i> Triplet Templates</label>
        <a href="#" class="editor-button editor-button-small" id="node-input-add-template" style="margin-top:4px; padding: 4px 10px;">
            <i class="fa fa-plus"></i> Add
        </a>
    </div>
    
    <!-- Compact template header row -->
    <div class="form-row" style="margin-top:10px; margin-bottom:5px; padding: 0 8px;">
        <div style="display: flex; width: 100%; padding-left: 100px; box-sizing: border-box;">
            <div style="flex: 1; margin-right: 8px; font-weight: bold; font-size: 14px;">Subject</div>
            <div style="flex: 1; margin-right: 8px; font-weight: bold; font-size: 14px;">Predicate</div>
            <div style="flex: 1; margin-right: 8px; font-weight: bold; font-size: 14px;">Object</div>
            <div style="margin-right: 8px; font-weight: bold; font-size: 14px;">Store</div>
            <div style="width: 40px;"></div>
        </div>
    </div>
    
    <!-- Template container with compact styling -->
    <div style="padding-left: 100px; min-height: 120px; margin-bottom: 15px;" id="node-input-template-container">
        <!-- Template rows will be added here -->
    </div>
    
    <!-- Custom Functions Section -->
    <div class="form-row" style="margin-top:20px; margin-bottom:0;">
        <label><i class="fa fa-code"></i> Tools</label>
    </div>
    <div id="node-input-function-container">
        <!-- Function editors will be added here -->
    </div>
    <div class="form-row" style="margin-top:15px;">
        <div style="display: flex; justify-content: center; width: 100%;">
            <a href="#" class="editor-button" id="node-input-add-function" style="padding: 8px 15px; font-size: 14px;">
                <i class="fa fa-plus"></i> Add Tool
            </a>
        </div>
    </div>
    
    <!-- Moved Payload field here, after the Tools section -->
    <div class="form-row" style="margin-top:20px;">
        <label for="node-input-payload"><i class="fa fa-envelope"></i> Payload</label>
        <input type="text" id="node-input-payload" placeholder="Default payload">
    </div>
</script>

<script type="text/html" data-help-name = "triplets">
    <p>A node that processes input messages and creates knowledge graph triplets with customizable templates.</p>
    
    <h3>Features</h3>
    <ul>
        <li><b>Input Processing:</b> Processes incoming flow messages, applying the configured default payload.</li>
        <li><b>MQTT Integration:</b> Always connects to MQTT topics for message input and output.</li>
        <li><b>Knowledge Graph Templates:</b> Define triplets in subject-predicate-object format with dynamic values from message paths.</li>
        <li><b>Individual Storage Options:</b> Each triplet can be individually configured for storage using the common API endpoint.</li>
        <li><b>Tools:</b> Add multiple Python function tools to process messages with full access to Node-RED context variables.</li>
    </ul>
    
    <h3>Triplet Format</h3>
    <p>Each triplet template consists of:</p>
    <ul>
        <li><b>Subject:</b> The entity that the triplet refers to (select from dropdown with predefined values)</li>
        <li><b>Predicate:</b> The relationship between subject and object (select from dropdown with predefined values)</li>
        <li><b>Object:</b> The object value or a path to extract from the message (e.g., "msg.payload.name")</li>
        <li><b>Store:</b> Whether to store this triplet via the API endpoint</li>
    </ul>
    
    <h3>Dynamic Values</h3>
    <p>You can use paths like "msg.payload.value" or "msg.topic" in the object field to dynamically extract values from incoming messages.</p>
    
    <h3>Subject and Predicate Options</h3>
    <p>The subject and predicate dropdowns are populated with predefined entities and relations.</p>
    
    <h3>Storage</h3>
    <p>Triplets marked for storage will be sent to the configured API endpoint. All triplets use the same endpoint, but you can choose which ones to store individually.</p>
    
    <h3>Tools</h3>
    <p>Add Python function tools to process messages. Each tool has access to:</p>
    <ul>
        <li><b>msg:</b> The message object being processed (as a Python dictionary)</li>
        <li><b>node:</b> A reference to the node itself</li>
        <li><b>context:</b> The node's context storage</li>
        <li><b>flow:</b> The flow context storage</li>
        <li><b>global:</b> The global context storage</li>
    </ul>
    <p>Tools should return the message object to pass it to the next node. Tool functions use Python Doxygen-style documentation and Python syntax.</p>
    <p>Example Python tool:</p>
    <pre>"""
Calculate the greatest common divisor of two numbers

Parameters
----------
a : int
    First integer
b : int
    Second integer

Returns
-------
int
    Greatest common divisor of a and b
"""
def gcd(a, b):
    """Compute the greatest common divisor of a and b"""
    while b:
        a, b = b, a % b
    return a

# Example usage
print(gcd(48, 18))  # 6
print(gcd(101, 103))  # 1</pre>
    
    <h3>Example</h3>
    <p>For incoming message: <code>{"payload": {"name": "John", "symptom": "Headache"}}</code></p>
    <p>With templates:</p>
    <ul>
        <li>subject: "Patient", predicate: "has_appointment_with", object: "msg.payload.name"</li>
        <li>subject: "Patient", predicate: "has_symptom", object: "msg.payload.symptom"</li>
    </ul>
    <p>Produces triplets:</p>
    <ul>
        <li>(Patient, has_appointment_with, "John")</li>
        <li>(Patient, has_symptom, "Headache")</li>
    </ul>
</script>